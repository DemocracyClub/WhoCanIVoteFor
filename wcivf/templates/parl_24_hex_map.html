{% load static %}
{% load parl_24 %}
<script src="{% static "js/hexmap.min.js" %}"></script>
<style>
    #hexmap {
        height: 60vw;
        max-height: 700px;
        width: 100%;
        position: relative; animation-duration: 0.3s;
    }


    #hexmap .hover path {
        stroke-width: 4px;
    }

    @media only screen and (max-width: 700px) {
        /* Don't bother with labels if it is too small */
        #hexmap .hex-label {
            display: none;
        }
    }

    #hexmap .tooltip {
        position: absolute;
        text-align: center;
        background: black;
        color: white;
        padding: 0.25em 0.5em;
        transform: translate3d(-50%, 50%, 0);
        transition: left 0.1s linear, top 0.1s linear;
        border-radius: 4px;
    }

    #hexmap .tooltip::after {
        content: "";
        position: absolute;
        bottom: auto;
        width: 0;
        height: 0;
        border: 0.5em solid transparent;
        left: 50%;
        top: 0%;
        transform: translate3d(-50%, -100%, 0);
        border-color: transparent;
        border-bottom-color: black;
    }

</style>


<div id="hexmap"></div>


<script>
    hex = new OI.hexmap(document.getElementById('hexmap'), {
        // Define the HexJSON - https://open-innovations.org/projects/hexmaps/hexjson
        'hexjson': {
            "layout": "odd-r",
            "version": "1.1",
            "hexes": {
                {% for ballot in hex_data %}
                    {{ ballot|constituency_to_hex_row }}
                {% endfor %}
            }
        }

    });


    // Make a tooltip
    hex.on('mouseover', function (e) {
        var svg, tip, bb, bbo, hex;
        svg = e.data.hexmap.el;
        hex = e.target;
        // Get any existing tooltip for this hexmap
        tip = svg.querySelector('.tooltip');
        if (!tip) {
            // Add a new tooltip
            tip = document.createElement('div');
            tip.classList.add('tooltip');
            svg.appendChild(tip);
        }
        // Update contents of tooltip
        tip.innerHTML = e.data.data.n + '<br>' + e.data.data.party_name;
        // Update position of tooltip
        bb = hex.getBoundingClientRect();
        bbo = svg.getBoundingClientRect();
        tip.style.left = Math.round(bb.left + bb.width / 2 - bbo.left + svg.scrollLeft) + 'px';
        tip.style.top = Math.round(bb.top + bb.height / 2 - bbo.top) + 'px';
    });

</script>
