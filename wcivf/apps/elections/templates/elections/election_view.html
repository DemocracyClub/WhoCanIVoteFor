{% extends "base.html" %}
{% load markdown_deux_tags %}
{% load breadcrumb_tags %}
{% load humanize %}

{% block page_title %}{{ object.name }}{% endblock page_title %}
{% block og_title %}{{ object.name }}{% endblock og_title %}
{% block og_description %}The {{ object.name }} {% if object.in_past %}was{% else %}will be{% endif %} held on {{ object.election_date }}.{% endblock og_description %}

{% block content %}
  <div class="ds-scope">
    <div class="ds-stack">
      <h1>{{ object.nice_election_name }}</h1>

      <p>The {{ object.nice_election_name }}
        {% if object.is_election_day %}
          <strong>is being held today</strong>.
          Polls are open from {{ object.polls_open|time:"ga" }} till {{ object.polls_close|time:"ga" }}
        {% else %}
          {% if object.in_past %}was{% else %}will be{% endif %} held <strong>{{ object.election_date|naturalday:"\o\n l j F Y" }}</strong>.
        {% endif %}
      </p>

      {% if object.election_type != "ref" %}
        {% if election.personpost_set.count %}
          <p>{% if object.locked %}There are {% else %}We know about {% endif %}<strong>{{ election.personpost_set.count }}</strong> candidates
            {% if object.in_past %}that stood{% else %}standing{% endif %} for this election,
            in <strong>{{ object.postelection_set.count }}</strong> {{ object.pluralized_division_name }}.</p>
        {% endif %}


        {{ object.description|markdown }}

        <h2>Parties</h2>
        <p>{{ object.parties.keys|length }} parties are contesting {{ object.postelection_set.seats_total }} seats across {{ object.postelection_set.count }} {{ object.pluralized_division_name }}.</p>
        <div class="ds-grid">
          {% for party_id, party_data in object.parties.items %}
            <div class="ds-with-sidebar">
              <div>
                <div class="ds-sidebar" style="flex-basis: 5rem">{% if party_data.party.emblem %}<img src="{{ party_data.party.emblem.url }}">{% endif %}</div>
                <div class="ds-not-sidebar">
                  {{ party_data.party.party_name }}<br>
                  {{ party_data.count }} candidate{{ party_data.count|pluralize }}

                </div>
              </div>
            </div>
          {% endfor %}


        </div>


        <h2>{{ object.pluralized_division_name|title }}</h2>
        <table>
          <tr>
            <th>Name</th>
            <th>Candidates</th>
          </tr>
          {% for postelection in object.postelection_set.all %}
            <tr>
              <td><a href="{{ postelection.get_absolute_url }}">{{ postelection.post.label }}</a>
                {{ postelection.short_cancelled_message_html }}</td>
              <td>{{ postelection.personpost_set.count }}</td>

            </tr>
          {% endfor %}
        </table>
      {% endif %}
      <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Event",
      "name": "{{ object.name }}",
      "startDate" : "{{ object.election_date }}",
      "url" : "{{ CANONICAL_URL }}{% url 'election_view' object.slug object.name|slugify %}",
      "location" : {
        "@type" : "Place",
        "name" : "UK",
      }
    }
    </script>


      <section>
        {% include "elections/includes/_postcode_search_form.html" %}
      </section>
    </div>
  </div>
{% endblock content %}

{% block breadcrumbs %}
  <ol vocab="http://schema.org/" typeof="BreadcrumbList" class="breadcrumbs" aria-label="You are here:" role="navigation">
    {% url 'home_view' as home_view %}
    {% breadcrumb_item home_view 'Home' 1 %}
    {% url 'elections_view' as elections %}
    {% breadcrumb_item elections 'Elections' 2 %}
    <li class="disabled"><span class="show-for-sr">Current: </span> {{ object.nice_election_name }}</li>
  </ol>

{% endblock breadcrumbs %}
